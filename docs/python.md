# `GenAIFramework Gem` API for Python usage

## Available Python EBusses
### AIAgentRequestBus
TWo EBus methods are available for communication with an Agent in Python:
- GetHistory
- SendPrompt

The `GetHistory` method returns the history of the agent. The history is a JSON string containing the prompts and responses. It consists of a list of objects with roles and content. The roles can be `user`, `assistant`, or `system` corresponding to the user, assistant, or system message respectively.
The content is the message itself. It is a list of strings generated by the model or the user. You can use the `GetHistory` method as follows:
```python
from azlmbr.ai import AIAgentRequestBus
from azlmbr.bus import bus

history = AIAgentRequestBus(bus.Event, "GetHistory", agentId)
```
The history variable will become a JSON string containing the history of the agent. For example:
```json
[
    {
        "role": "system",
        "content": ["Only respond in one word."]
    },
    {
        "role": "user",
        "content": ["What is a dog?"]
    },
    {
        "role": "assistant",
        "content": ["Animal"]
    }
]
```

The `SendPrompt` method sends a prompt to the agent. The prompt is also a JSON string containing the roles and content. The format of the prompt is the same as the history. You can use the `SendPrompt` method as follows:
```python
from azlmbr.ai import AIAgentRequestBus

prompt = '[{"role": "user", "content": ["What is a dog?"]}]'

AIAgentRequestBus(bus.Event, "SendPrompt", agentId, prompt) # Agent ID is usually passed as an argument
```
The `agentId` is an argument passed to a Python feature during its creation. It represents the ID of the agent.

### AIAgentNotificationBusHandler
In Python, the `AIAgentNotificationBusHandler` is used to receive notifications from the agent. The notifications are sent when the agent has a response ready. The `OnAIResponse` method is called when the agent has a response ready. You can use the `AIAgentNotificationBusHandler` as follows:
```python
from azlmbr.ai import AIAgentNotificationBusHandler

def OnAIResponse(message):
    # Handle the response

handler = AIAgentNotificationBusHandler()
handler.connect(agentId) # Agent ID is usually passed as an argument
handler.add_callback("OnAIResponse", OnAIResponse)
```
The message parameter is a JSON string containing the response. The format of the response is a single object with role and content. For example:
```json
{
    "role": "assistant",
    "content": ["Animal"]
}
```

### ConversationNotificationBus
In Python, the `ConversationNotificationBus` is used to receive and send notification. Receiving the notification is done using `ConversationNotificationBusHandler` and sending using `ConversationNotificationBus`. The behavior of this handler is similar to the `AIAgentNotificationBusHandler`. The `OnNewMessage` method is called when a new message from the UI is received. You can use the `ConversationNotificationBusHandler` as follows:
```python
from azlmbr.ai import ConversationNotificationBus

def OnNewMessage(message):
    # Handle the message

handler = ConversationNotificationBusHandler()
handler.connect(conversationId) # Conversation ID is usually passed as an argument
handler.add_callback("OnNewMessage", OnNewMessage)
```
The message parameter is a list of length 1 containing the string message from the UI. For example:
```json
["What is a dog?"]
```

The `ConversationNotificationBus` is used to send a message to the UI. The `OnFeatureResponse` method sends a response to the UI. This method needs three 
arguments: the conversation ID (usually passed as an argument), a string response, list of strings containing other information about the response. You can use the `ConversationNotificationBus` as follows:
```python
from azlmbr.ai import ConversationNotificationBus
from azlmbr.bus import bus

response = "Animal"
summary = ["This is a summary"]

ConversationNotificationBus(bus.Event, "OnFeatureResponse", conversationId, response, summary) # Conversation ID is usually passed as an argument
``` 
The `response` parameter is the main response to the UI. It will be immediately shown to the user. The `summary` parameter is a list of strings containing additional information about the response. This can consist of steps taken by the Feature or other significant information the user might want to know.

## Async python API (deprecated)

The API allows you to get responses from AI services in an asynchronous way. 
It is based on the `AZ::EBus` and `AZ::BehaviorContext`. 

Selecting an available AI service and model configuration can be done by first getting all available models:
```python
import azlmbr.ai
import azlmbr.bus as bus
serviceProvidersNames = azlmbr.ai.GenAIFrameworkRequestBus(bus.Broadcast, 'GetServiceProviderNames')
modelConfigurationsNames = azlmbr.ai.GenAIFrameworkRequestBus(bus.Broadcast, 'GetModelConfigurationNames')
```

And after getting the available methods the models can be selected:
```python
result = azlmbr.ai.asyncRequestBus(bus.Broadcast, 'SetServiceProviderByName', 'example_name')
result = azlmbr.ai.asyncRequestBus(bus.Broadcast, 'SetModelConfigurationByName', 'example_name')
```
The result is true if the model configuration or service provider is found and set. False otherwise. It is also possible to verify which model configuration or service provider is currently set by calling the following:
```python
providerName = azlmbr.ai.asyncRequestBus(bus.Broadcast, 'GetActiveServiceProviderName')
modelConfiguration = azlmbr.ai.asyncRequestBus(bus.Broadcast, 'GetActiveModelConfigurationName')
```
The output name might be empty in the case of a service provider or model configuration respectively being not set.

Sending a prompt example:
```python
ticket = azlmbr.ai.asyncRequestBus(bus.Broadcast, 'SendPromptToLLM', "Hello World")
```
The ticket is a random identifier used to identify the response.

You can ask if the response is ready using the following example:
```python
is_ready = azlmbr.ai.asyncRequestBus(bus.Broadcast, 'IsResponseReady', ticket)
print(is_ready)
```

Use the subsequent code snippet to get the response (when available):
```python
response = azlmbr.ai.asyncRequestBus(bus.Broadcast, 'GetResponse', ticket)
print(response)
```

To get a registered name of the currently used model configuration or service provider use:
```python
registered_name = azlmbr.ai.asyncRequestBus(azlmbr.bus.Broadcast, "GetModelConfigurationTypename")
registered_name = azlmbr.ai.asyncRequestBus(azlmbr.bus.Broadcast, "GetServiceProviderTypename")
``` 

To reset the model history, use the following code snippet:
```python
azlmbr.ai.asyncRequestBus(bus.Broadcast, 'ResetModelHistory')
```

Changing the model configurations can be done by calling the following:
```python
result = azlmbr.ai.asyncRequestBus(bus.Broadcast, "SetModelParameter", "systemMessage", "This is a test system message")
```
The result will be an empty string if the model parameter is set successfully. Otherwise, it will contain an error message.

To enable or disable the model history, use the following code snippet:
```python
# Enable model history
azlmbr.ai.asyncRequestBus(bus.Broadcast, 'EnableModelHistory', True)
# Disable model history
azlmbr.ai.asyncRequestBus(bus.Broadcast, 'EnableModelHistory', False)
```
